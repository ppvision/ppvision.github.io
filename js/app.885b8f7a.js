(function(){var e={9070:function(e,t,i){var n;i(3767),i(8585),i(8696),i(7658),i(2801),t.eP=t.TN=void 0,function(e){e[e["UsbCdcAcm"]=0]="UsbCdcAcm"}(n=t.TN||(t.TN={}));const r=32,a=34,s=35,o=255,l=8,c="none",d=1,u=[16,8,7,6,5],h=[1,2],f=["none","even","odd"],g=["none","odd","even"],p=[1,1.5,2],b={protocol:n.UsbCdcAcm,usbControlInterfaceClass:2,usbTransferInterfaceClass:10};function m(e,t){const i=e.configurations[0];if("Silicon Labs"==e.manufacturerName||4292==e.vendorId&&6e4==e.productId)return e.is_cp210x=!0,i.interfaces[0];"Raspberry Pi"==e.manufacturerName&&"Pico"==e.productName&&(e.is_pico=!0),6790==e.vendorId&&i.interfaces.map(((e,i)=>{console.log(`Lookup Class:${t} [${i}]iface::[${e.alternates[0].interfaceClass}]`)}));for(const n of i.interfaces){const e=n.alternates[0];if(e.interfaceClass===t)return n}throw new TypeError(`Unable to find interface with class ${t}.`)}function v(e,t){const i=e.alternates[0];for(const n of i.endpoints)if(n.direction==t)return n;throw new TypeError(`Interface ${e.interfaceNumber} does not have an ${t} endpoint.`)}class w{constructor(e,t,i){this.type="bytes",this.device_=e,this.endpoint_=t,this.onError_=i}pull(e){(async()=>{var t;let i;if(e.desiredSize){const t=e.desiredSize/this.endpoint_.packetSize;i=Math.ceil(t)*this.endpoint_.packetSize}else i=this.endpoint_.packetSize;try{const n=await this.device_.transferIn(this.endpoint_.endpointNumber,i);if("ok"!=n.status&&(e.error(`USB error: ${n.status}`),this.onError_()),null===(t=n.data)||void 0===t?void 0:t.buffer){const t=new Uint8Array(n.data.buffer,n.data.byteOffset,n.data.byteLength);e.enqueue(t)}}catch(n){e.error(n.toString()),this.onError_()}})()}}class _{constructor(e,t,i){this.device_=e,this.endpoint_=t,this.onError_=i}async write(e,t){try{const i=await this.device_.transferOut(this.endpoint_.endpointNumber,e);"ok"!=i.status&&(t.error(i.status),this.onError_())}catch(i){t.error(i.toString()),this.onError_()}}}class y{constructor(e,t){this.polyfillOptions_=Object.assign(Object.assign({},b),t),this.outputSignals_={dataTerminalReady:!1,requestToSend:!1,break:!1},this.device_=e;let i=null;i?this.controlInterface_=this.transferInterface_=i:(this.controlInterface_=m(this.device_,this.polyfillOptions_.usbControlInterfaceClass),this.transferInterface_=m(this.device_,this.polyfillOptions_.usbTransferInterfaceClass)),this.inEndpoint_=v(this.transferInterface_,"in"),this.outEndpoint_=v(this.transferInterface_,"out")}get readable(){var e;return!this.readable_&&this.device_.opened&&(this.readable_=new ReadableStream(new w(this.device_,this.inEndpoint_,(()=>{this.readable_=null})),{highWaterMark:null!==(e=this.serialOptions_.bufferSize)&&void 0!==e?e:o})),this.readable_}get writable(){var e;return!this.writable_&&this.device_.opened&&(this.writable_=new WritableStream(new _(this.device_,this.outEndpoint_,(()=>{this.writable_=null})),new ByteLengthQueuingStrategy({highWaterMark:null!==(e=this.serialOptions_.bufferSize)&&void 0!==e?e:o}))),this.writable_}async open(e){this.serialOptions_=e,this.validateOptions();try{await this.device_.open(),null===this.device_.configuration&&await this.device_.selectConfiguration(1),await this.device_.reset(),await this.device_.claimInterface(this.controlInterface_.interfaceNumber,!0).catch((async e=>{console.log("claimInterface ERROR:",e)})),this.controlInterface_!==this.transferInterface_&&await this.device_.claimInterface(this.transferInterface_.interfaceNumber),this.device_.is_cp210x?(await this.device_.controlTransferOut({requestType:"vendor",recipient:"device",request:0,index:0,value:1}).then((e=>{console.log(e)})).catch((e=>{console.log("ERR:",e)})),await this.device_.controlTransferOut({requestType:"vendor",recipient:"device",request:7,index:0,value:771}).then((e=>{console.log(e)})).catch((e=>{console.log("ERR:",e)})),await this.device_.controlTransferOut({requestType:"vendor",recipient:"device",request:1,index:0,value:32}).then((e=>{console.log(e)})).catch((e=>{console.log("ERR:",e)}))):(await this.setLineCoding(),await this.setSignals({dataTerminalReady:!0}))}catch(t){throw this.device_.opened&&await this.device_.close(),new Error("Error setting up device: "+t.toString())}}async close(){const e=[];this.readable_&&e.push(this.readable_.cancel()),this.writable_&&e.push(this.writable_.abort()),await Promise.all(e),this.readable_=null,this.writable_=null,this.device_.opened&&(await this.setSignals({dataTerminalReady:!1,requestToSend:!1}),await this.device_.close())}async forget(){return this.device_.forget()}getInfo(){return{usbVendorId:this.device_.vendorId,usbProductId:this.device_.productId}}reconfigure(e){return this.serialOptions_=Object.assign(Object.assign({},this.serialOptions_),e),this.validateOptions(),this.setLineCoding()}async setSignals(e){if(this.outputSignals_=Object.assign(Object.assign({},this.outputSignals_),e),void 0!==e.dataTerminalReady||void 0!==e.requestToSend){const e=(this.outputSignals_.dataTerminalReady?1:0)|(this.outputSignals_.requestToSend?2:0);await this.device_.controlTransferOut({requestType:"class",recipient:"interface",request:a,value:e,index:this.controlInterface_.interfaceNumber})}if(void 0!==e.break){const e=this.outputSignals_.break?65535:0;await this.device_.controlTransferOut({requestType:"class",recipient:"interface",request:s,value:e,index:this.controlInterface_.interfaceNumber})}}validateOptions(){if(!this.isValidBaudRate(this.serialOptions_.baudRate))throw new RangeError("invalid Baud Rate "+this.serialOptions_.baudRate);if(!this.isValidDataBits(this.serialOptions_.dataBits))throw new RangeError("invalid dataBits "+this.serialOptions_.dataBits);if(!this.isValidStopBits(this.serialOptions_.stopBits))throw new RangeError("invalid stopBits "+this.serialOptions_.stopBits);if(!this.isValidParity(this.serialOptions_.parity))throw new RangeError("invalid parity "+this.serialOptions_.parity)}isValidBaudRate(e){return e%1===0}isValidDataBits(e){return"undefined"===typeof e||u.includes(e)}isValidStopBits(e){return"undefined"===typeof e||h.includes(e)}isValidParity(e){return"undefined"===typeof e||f.includes(e)}async setLineCoding(){var e,t,i;const n=new ArrayBuffer(7),a=new DataView(n);a.setUint32(0,this.serialOptions_.baudRate,!0),a.setUint8(4,p.indexOf(null!==(e=this.serialOptions_.stopBits)&&void 0!==e?e:d)),a.setUint8(5,g.indexOf(null!==(t=this.serialOptions_.parity)&&void 0!==t?t:c)),a.setUint8(6,null!==(i=this.serialOptions_.dataBits)&&void 0!==i?i:l);const s=await this.device_.controlTransferOut({requestType:"class",recipient:"interface",request:r,value:0,index:this.controlInterface_.interfaceNumber},n);if("ok"!=s.status)throw new DOMException("NetworkError","Failed to set line coding.")}}class C{async requestPort(e,t){t=Object.assign(Object.assign({},b),t);const i=[];if(e&&e.filters)for(const a of e.filters){const e={classCode:t.usbControlInterfaceClass};void 0!==a.usbVendorId&&(e.vendorId=a.usbVendorId),void 0!==a.usbProductId&&(e.productId=a.usbProductId),i.push(e)}0===i.length&&i.push({classCode:t.usbControlInterfaceClass});const n=await navigator.usb.requestDevice({filters:[]}),r=new y(n,t);return r}async getPorts(e){e=Object.assign(Object.assign({},b),e);const t=await navigator.usb.getDevices(),i=[];return t.forEach((t=>{try{const n=new y(t,e);i.push(n)}catch(n){}})),i}}t.eP=new C},9789:function(e,t,i){"use strict";var n=i(7195),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("Xterm",{ref:"xterm",attrs:{msg:"Welcome to Your Vue.js App",onData:e.onTermData},on:{serialConfig:e.serialConfig}})],1)},a=[],s=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"contextmenu",rawName:"v-contextmenu:contextmenu",arg:"contextmenu"}],staticClass:"terminal",style:{backgroundColor:e.bgColor,color:e.fontColor},attrs:{id:"terminal"},on:{click:e.handleMove,mousemove:e.handleMove}},[t("div",{staticClass:"header"},[t("span",[e._v("串口终端")]),t("ul",{staticClass:"menu-list"},[e._e(),t("li",{staticClass:"el-icon-plus",on:{click:e.handlePlus}}),t("li",{staticClass:"el-icon-delete",on:{click:e.handleDelete}}),t("li",{staticClass:"el-icon-download",on:{click:e.downloadTxt}})])]),t("div",{attrs:{id:"xterm-wrapper"}},e._l(e.tabs,(function(i,n){return t("div",{directives:[{name:"show",rawName:"v-show",value:n==e.currentTab,expression:"index == currentTab"}],key:n,staticClass:"xterm-tabs"},[i.children.length>=4?t("div",{staticClass:"xterm-tab-item"},[t("el-row",{staticClass:"el-row-4",attrs:{type:"flex"}},e._l(i.children.slice(0,2),(function(i,n){return t("el-col",{key:n,staticClass:"el-col",attrs:{span:12}},[t("div",{staticClass:"terminal-pane",attrs:{id:i.name}}),t("div",{staticClass:"serial_status"},[e._v(" "+e._s(i.online?"Online":"Offline"))])])})),1),t("el-row",{staticClass:"el-row-4",attrs:{type:"flex"}},e._l(i.children.slice(2),(function(i,n){return t("el-col",{key:n,staticClass:"el-col",attrs:{span:12}},[t("div",{staticClass:"terminal-pane",attrs:{id:i.name}}),t("div",{staticClass:"serial_status"},[e._v(" "+e._s(i.online?"Online":"Offline"))])])})),1)],1):t("div",{staticClass:"xterm-tab-item"},[t("el-row",{attrs:{type:"flex"}},e._l(i.children,(function(n,r){return t("el-col",{key:r,staticClass:"el-col",attrs:{span:24/i.children.length}},[t("div",{staticClass:"terminal-pane",attrs:{id:n.name}}),t("div",{staticClass:"serial_status"},[e._v(" "+e._s(n.online?"Online":"Offline"))])])})),1)],1)])})),0),t("v-contextmenu",{ref:"contextmenu",staticClass:"contextmenu"},[t("v-contextmenu-item",{on:{click:e.handleSplitPane}},[e._v("分屏")]),e.tabs.length&&e.tabs[0].children.length>1?t("v-contextmenu-item",{on:{click:e.handleDelete}},[e._v("关闭")]):e._e(),t("v-contextmenu-item",{on:{click:function(t){e.dialogVisible=!0,e.config_type="color"}}},[e._v("设置")])],1),t("config-modal",{attrs:{visible:e.dialogVisible,config_type:e.config_type},on:{"update:visible":function(t){e.dialogVisible=t},setTheme:e.handleChangeTheme,serialConfig:e.serialConfig}})],1)},o=[],l=(i(7658),i(2510)),c=i(9853),d=i(4142),u=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"dialog-modal"},[t("div",{staticClass:"config-container"},[t("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{directives:[{name:"show",rawName:"v-show",value:"serial"==e.config_type,expression:"'serial' == config_type"}],attrs:{label:"串口配置",name:"second"}},[t("el-form",{ref:"form",attrs:{model:e.serialConfig,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"波特率"}},[t("el-select",{attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"波特率"},model:{value:e.serialConfig.baudRate,callback:function(t){e.$set(e.serialConfig,"baudRate",t)},expression:"serialConfig.baudRate"}},e._l(e.baudRate,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"数据位"}},[t("el-radio-group",{model:{value:e.serialConfig.dataBits,callback:function(t){e.$set(e.serialConfig,"dataBits",t)},expression:"serialConfig.dataBits"}},[t("el-radio",{attrs:{label:8}},[e._v("8位")]),t("el-radio",{attrs:{label:7}},[e._v("7位")])],1)],1),t("el-form-item",{attrs:{label:"停止位"}},[t("el-radio-group",{model:{value:e.serialConfig.stopBits,callback:function(t){e.$set(e.serialConfig,"stopBits",t)},expression:"serialConfig.stopBits"}},[t("el-radio",{attrs:{label:1}},[e._v("1位")]),t("el-radio",{attrs:{label:2}},[e._v("2位")])],1)],1),t("el-form-item",{attrs:{label:"流控"}},[t("el-radio-group",{model:{value:e.serialConfig.flowControl,callback:function(t){e.$set(e.serialConfig,"flowControl",t)},expression:"serialConfig.flowControl"}},[t("el-radio",{attrs:{label:"none"}},[e._v("none")]),t("el-radio",{attrs:{label:"hardware"}},[e._v("hardware")])],1)],1),t("el-form-item",{attrs:{label:"校验方式"}},[t("el-radio-group",{model:{value:e.serialConfig.parity,callback:function(t){e.$set(e.serialConfig,"parity",t)},expression:"serialConfig.parity"}},[t("el-radio",{attrs:{label:"none"}},[e._v("none")]),t("el-radio",{attrs:{label:"even"}},[e._v("even")]),t("el-radio",{attrs:{label:"odd"}},[e._v("odd")])],1)],1)],1)],1),t("el-tab-pane",{directives:[{name:"show",rawName:"v-show",value:"color"==e.config_type,expression:"config_type =='color'"}],attrs:{label:"主题",name:"first"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择主题"},model:{value:e.theme,callback:function(t){e.theme=t},expression:"theme"}},e._l(e.themes,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1),e.theme?t("div",[t("p",{staticClass:"title"},[e._v("基础颜色")]),t("el-row",{staticClass:"theme-colors",attrs:{type:"flex"}},[t("el-col",{attrs:{span:8}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.background}}),t("div",[e._v("Background")])]),t("el-col",{attrs:{span:8}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.foreground}}),t("div",[e._v("Foreground")])]),t("el-col",{attrs:{span:8}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.cursor}}),t("div",[e._v("Cursor")])])],1),t("p",{staticClass:"title"},[e._v("ANSI Colors")]),t("el-row",{staticClass:"theme-colors",attrs:{type:"flex"}},[t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.black}}),t("div",[e._v("Black")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.red}}),t("div",[e._v("Red")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.green}}),t("div",[e._v("Green")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.yellow}}),t("div",[e._v("Yellow")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.blue}}),t("div",[e._v("Blue")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.magenta}}),t("div",[e._v("Magenta")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.cyan}}),t("div",[e._v("Cyan")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.white}}),t("div",[e._v("White")])])],1),t("el-row",{staticClass:"theme-colors",attrs:{type:"flex"}},[t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightBlack}}),t("div",[e._v("BrightBlack")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightRed}}),t("div",[e._v("BrightRed")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightGreen}}),t("div",[e._v("BrightGreen")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightYellow}}),t("div",[e._v("BrightYellow")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightBlue}}),t("div",[e._v("BrightBlue")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightMagenta}}),t("div",[e._v("BrightMagenta")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightCyan}}),t("div",[e._v("BrightCyan")])]),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightWhite}}),t("div",[e._v("BrightWhite")])])],1)],1):e._e()],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.$emit("update:visible",!1)}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.Btn_Click("OK")}}},[e._v("确 定")])],1)],1)])},h=[],f=i(4440),g=i.n(f);const p=Object.keys(g());var b={name:"ConfigModal",props:{visible:Boolean,config_type:{type:String,default:"serial"}},data(){return{activeName:"second",themes:p,theme:window.localStorage.getItem("themeName")||null,bgimg:window.localStorage.getItem("bgimg")||null,baudRate:[{value:9600,label:"9600"},{value:14400,label:"14400"},{value:19220,label:"19220"},{value:28800,label:"28800"},{value:38400,label:"38400"},{value:57600,label:"57600"},{value:115200,label:"115200"},{value:230400,label:"230400"},{value:460800,label:"460800"}],serialConfig:{baudRate:115200,dataBits:8,stopBits:1,parity:"none",bufferSize:1024,flowControl:"none"}}},computed:{colors(){return this.theme?g()[this.theme]:null}},watch:{theme(e){window.localStorage.setItem("themeName",e),this.$emit("setTheme",g()[e])}},methods:{handleUpload(e){let t=e.target.files[0];var i=new FileReader;i.readAsDataURL(t),i.onload=e=>{this.bgimg=e.target.result,window.localStorage.setItem("bgimg",e.target.result)}},handleClick(){},cancleDialog(){this.$emit("update:visible",!1)},Btn_Click(e){"OK"==e&&(this.$emit("update:visible",!1),this.$emit("serialConfig",this.serialConfig))}}},m=b,v=i(1001),w=(0,v.Z)(m,u,h,!1,null,"4a142f74",null),_=w.exports;function y(e,t){return t.clientY>=e.top&&t.clientY<=e.top+e.height&&t.clientX>=e.left&&t.clientX<=e.left+e.width}var C={name:"SerialTerminal",props:{caption:{type:String,default:""},prompt:{type:String,default:"$"},onData:{type:Function,default:null},onKey:{type:Function,default:null}},data(){return{term:null,tabs:[],config_type:"",socket:null,currentTab:0,dialogVisible:!1,theme:window.localStorage.getItem("theme")?JSON.parse(window.localStorage.getItem("theme")):{foreground:"#ECECEC",background:"#000000",cursor:"help",lineHeight:20}}},computed:{bgColor(){return this.theme?this.theme.background:"#000"},fontColor(){return this.theme?this.theme.foreground:"#fff"}},components:{ConfigModal:_},methods:{createTerminal(e,t){let i=this,n="terminal"+(0,c.Z)(),r=new l.Terminal({theme:this.theme,disableStdin:!1});r.fitAddon=new d.FitAddon,r.loadAddon(r.fitAddon),r.prompt=()=>{r.write("[33m$[0m>")},r.onKey((e=>{let t=e.domEvent;return"k"==t.key&&(t.ctrlKey||t.metaKey)?(r.clear(),!0):!(!i.onKey||!i.onKey(e,r))||void 0}));let a={term:r,name:n,serial:null,online:!1};r.pane=a,r.onData((e=>{console.log(`onData:[${e.toString()}]`,typeof e),i.onData?i.onData(e,r):r.write(e)})),e.children.push(a),e.currentPane=e.children.length-1,t&&t(),window.addEventListener("resize",(()=>{r.fitAddon.fit()})),this.$nextTick((()=>{let t=document.getElementById(n);r.open(t),e.children.forEach((e=>{let t=document.getElementById(e.name);e.term.element!=t.children[0]&&(t.innerHTML="",t.append(e.term.element)),e.term.fitAddon.fit(),e.rect=e.term.element.getBoundingClientRect()}))}))},handlePlus(){this.handleSplitPane()},downloadTxt(){let e=this.tabs[this.currentTab],{term:t}=e.children[e.currentPane];if(0===t.rows)return void console.log("No output yet");t.selectAll();const i=t.getSelection();t.clearSelection();const n=URL.createObjectURL(new Blob([(new TextEncoder).encode(i).buffer],{type:"text/plain"})),r=document.createElement("a");r.download=`terminal_content_${(new Date).getTime()}.txt`,r.href=n,r.click()},async handleDelete(){if(1==this.tabs.length&&1==this.tabs[this.currentTab].children.length)return this.$message({type:"warning",message:"仅有一个分屏窗口"}),!1;{let e=this.tabs[this.currentTab],{term:t,serial:i}=e.children[e.currentPane],n=!0;if(i&&(n=await this.$confirm("串口已经打开，是否关闭?","提示",{confirmButtonText:"关闭",cancelButtonText:"取消",type:"warning"}).then((()=>!0)).catch((()=>!1))),!n)return;if(i&&i.close(),t.destroy&&t.destroy(),e.children.length>1)e.children.splice(e.currentPane,1),e.currentPane=e.children.length-1,this.$nextTick((()=>{e.children.forEach((e=>{let t=document.getElementById(e.name);e.term.element!=t.children[0]&&(t.innerHTML="",t.append(e.term.element)),e.term.fitAddon.fit(),e.rect=e.term.element.getBoundingClientRect()})),e.children[e.currentPane].term.focus()}));else{this.tabs.splice(this.currentTab,1),this.currentTab=this.tabs.length-1;let e=this.tabs[this.currentTab];e.currentPane=e.children.length-1,e.children[e.currentPane].term.focus(),this.$nextTick((()=>{this.tabs.forEach((e=>{e.children.forEach((e=>{let t=document.getElementById(e.name);e.term.element!=t.children[0]&&(t.innerHTML="",t.append(e.term.element)),e.term.fitAddon.fit(),e.rect=e.term.element.getBoundingClientRect()})),e.children[e.currentPane].term.focus()}))}))}}},handleSplitPane(){let e=this.tabs[this.currentTab];if(e.children.length>=4)return this.$message({type:"warning",message:"分屏已经达到最大数量"}),!1;this.createTerminal(e,null)},handleCreateTab(){let e={name:"tab0",children:[]};this.createTerminal(e,(()=>{this.tabs.push(e),this.currentTab=this.tabs.length-1}))},handleMove(e){let t=this.tabs[this.currentTab];if(!t)return;let i=t.children[t.currentPane];return!y(i.rect,e)&&(!this.dialogVisible&&void t.children.forEach((({term:i,rect:n},r)=>{y(n,e)?(i.focus(),t.currentPane=r):i.blur()})))},handleChangeTheme(e){this.theme=e;let t=this.tabs[this.currentTab],i=t.children[t.currentPane];i&&(i.term._core.options.theme=e),window.localStorage.setItem("theme",JSON.stringify(e))},showConfigDlg(e,t=""){this.config_type=t,this.dialogVisible=e},serialConfig(e){if("serial"==this.config_type){let t=this.tabs[this.currentTab],i=t.children[t.currentPane];this.$emit("serialConfig",{conf:e,pane:i})}},close(){this.tabs.length>0&&this.tabs.forEach((e=>{e.children&&e.children.forEach((({term:e})=>{e.destroy&&e.destroy()}))}))}},created(){window.onkeydown=window.onkeyup=window.onkeypress=()=>{let e=window.event.keyCode;if(70===e&&window.event.ctrlKey){window.event.returnValue=!1;let e=this.tabs[this.currentTab];return e.children[e.currentPane].term.findNext("go",{incremental:!0}),!1}},window.onunload=()=>{this.close()}},mounted(){if(0==this.tabs.length){let e={name:"tab0",children:[]};this.createTerminal(e,(()=>{this.tabs.push(e),this.currentTab=this.tabs.length-1}))}},beforeDestroy(){this.close()}},k=C,T=(0,v.Z)(k,s,o,!1,null,"22a0a1c8",null),B=T.exports,O=i(2307);class x extends O.EventEmitter{constructor(e){super(),this.serial=e,this.connected=!1,this.reader=null}async getInfo(){return this.serial.getInfo()}state(){return this.serial.state}read(){let e=this;const t=()=>{let i=e.serial.readable;if(!i)return"!readable";var n=i.getReader();e.reader=n,n.read().then((({value:i,done:r})=>{n.releaseLock(),i&&e.emit("data",i),r?(n.releaseLock(),e.connected=!1,e.emit("disconnect","down"),console.log("reader.read() DOWN")):t()})).catch((t=>{n.releaseLock(),console.log(t),e.connected=!1,e.emit("disconnect",t)}))};t()}open(e){let t=this;return new Promise(((i,n)=>{t.serial.open(e).then((()=>{t.connected=!0,t.emit("connect"),t.read(),i()})).catch((e=>{n(e)}))}))}close(){return new Promise(((e,t)=>{this.reader?this.reader.cancel().then((()=>this.serial.close())).then((()=>e())).catch((e=>{this.reader.releaseLock(),t(e)})):this.serial&&(this.reader=null,this.serial.close().then((()=>e())).catch((e=>t(e))))}))}write(e,t="string"){return new Promise(((i,n)=>{let r=this.serial.writable;r||n("!writable");const a=r.getWriter();if("string"===t){const t=new TextEncoder;a.write(t.encode(e)).then((e=>{console.log("    :",e),i()})).catch((e=>n(e)))}else"binary"===t?a.write(e).then((()=>i())).catch((e=>n(e))):console.log("Wirte:ELSE");a.releaseLock()}))}setSignals(e){return this.serial.setSignals(e)}getSignals(){return this.serial.getSignals()}forget(){this.serial.forget&&this.serial.forget()}}var S=i(9070);const I=10,E=(e=0)=>t=>`[${38+e};5;${t}m`,R=(e=0)=>(t,i,n)=>`[${38+e};2;${t};${i};${n}m`;function P(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[i,n]of Object.entries(t)){for(const[i,r]of Object.entries(n))t[i]={open:`[${r[0]}m`,close:`[${r[1]}m`},n[i]=t[i],e.set(r[0],r[1]);Object.defineProperty(t,i,{value:n,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="[39m",t.bgColor.close="[49m",t.color.ansi256=E(),t.color.ansi16m=R(),t.bgColor.ansi256=E(I),t.bgColor.ansi16m=R(I),t.rgbToAnsi256=(e,t,i)=>e===t&&t===i?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(i/255*5),t.hexToRgb=e=>{const t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:i}=t.groups;3===i.length&&(i=i.split("").map((e=>e+e)).join(""));const n=Number.parseInt(i,16);return[n>>16&255,n>>8&255,255&n]},t.hexToAnsi256=e=>t.rgbToAnsi256(...t.hexToRgb(e)),t}P();function $(...e){return console.log(...e)}async function N(e,t={baudRate:115200,dataBits:8,stopBits:1,parity:"none",bufferSize:1024,flowControl:"none"}){if(e)return e.open(t)}class D{constructor(){this.chunks=""}transform(e,t){this.chunks+=e;const i=this.chunks.split("\r\n");this.chunks=i.pop(),i.forEach((e=>t.enqueue(e)))}flush(e){e.enqueue(this.chunks)}}async function j(e,t,i=null){let n=this,{pane:r}=e;try{if(e.focus(),r.serial){let e=await this.$confirm("串口已经打开，是否关闭?","提示",{confirmButtonText:"关闭",cancelButtonText:"取消",type:"warning"}).then((()=>!0)).catch((()=>!1));if(!e)return;let t=r.serial.readable;t&&t.locked&&(t.releaseLock(),await t.cancel()),r.serial.close(),r.serial=null,r.online=!1}let s=navigator.serial?navigator.serial:S.eP;const o=await s.getPorts();console.log("PORTS",o),o&&o.map((e=>{console.log("GET info:",e.getInfo(),e.deviceId)}));var a=await s.requestPort().catch((()=>null));if(!a)return void console.log("no select port!");const l=new x(a,new D);let c=e=>{let t=r.term;if(t)if(console.log("Serial onRecv():==>",typeof e,e.byteLength),r.Decoder)r.Decoder(e,t,l);else{if(i)return void i(e,t,l);t.write(e)}},d=()=>{r.online=!1,$("Disconnected\n")},u=()=>{r.online=!0,$("Connected\n")};l.on("data",c),l.on("disconnect",d),l.on("connect",u);const h=await l.getInfo();console.log("GET INFO:",h),r.serial=l,await N(l,t).catch((e=>{console.log("OPEN ERROR:",e);let i=e.message.includes("The port is already open");i?(l.close(),N(l,t)):n.$message({type:"error",message:i?"端口己打开！":e.message})}))}catch(s){console.log(s)}}function M(e,t){let{pane:i}=e;return i.serial?0==i.online?(i.serial.close(),i.serial=null,list_serial()):i.serial.write(t).then((()=>{console.log("writeSerial OK")})).catch((e=>{console.log("writeSerial",e.message)})):list_serial()}var q={name:"App",components:{Xterm:B},data(){return{cache:null}},methods:{onTermData(e,t){let{serial:i,online:n}=t.pane;i&&n?n&&M.call(this,t,e):this.$refs.xterm.showConfigDlg(!0,"serial")},serialConfig(e){let{conf:t,pane:i}=e,{term:n}=i;j.call(this,n,t)}}},L=q,A=(0,v.Z)(L,r,a,!1,null,null,null),V=A.exports,U=i(5114),W=i.n(U),z=i(1664);n["default"].use(z.ZP),n["default"].config.productionTip=!1,n["default"].use(W()),new n["default"]({render:e=>e(V)}).$mount("#app")}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}i.m=e,function(){i.amdO={}}(),function(){var e=[];i.O=function(t,n,r,a){if(!n){var s=1/0;for(d=0;d<e.length;d++){n=e[d][0],r=e[d][1],a=e[d][2];for(var o=!0,l=0;l<n.length;l++)(!1&a||s>=a)&&Object.keys(i.O).every((function(e){return i.O[e](n[l])}))?n.splice(l--,1):(o=!1,a<s&&(s=a));if(o){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,r,a]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={143:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,a,s=n[0],o=n[1],l=n[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(r in o)i.o(o,r)&&(i.m[r]=o[r]);if(l)var d=l(i)}for(t&&t(n);c<s.length;c++)a=s[c],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(d)},n=self["webpackChunkserialapp"]=self["webpackChunkserialapp"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(9789)}));n=i.O(n)})();
//# sourceMappingURL=app.885b8f7a.js.map